<html>
<head>
    <meta charset="utf-8">
    <title>雅洁后台</title>
    <link rel="stylesheet" href="__STATIC__/plugins/layui/css/layui.css?v=1" media="all" />
    <link rel="stylesheet" type="text/css" href="__ADMIN__/qu/css/wenjuan_ht.css">
    <script src="http://www.jq22.com/jquery/jquery-1.7.1.js"></script>
    <script src="https://cdn.bootcss.com/layer/3.0.3/layer.min.js"></script>
    <script src="__ADMIN__/qu/js/index.js?v=2"></script>
    <style>
        #addquerstions{
            width: 30%;
            height: 36px;
            float: left;
            margin-right: 10px;
            border-color: #D2D2D2!important;
        }
        .btu{
            display: inline-block;
            height: 38px;
            line-height: 37px;
            padding: 0 18px;
            background-color: #0099ff;
            color: #fff;
            white-space: nowrap;
            text-align: center;
            font-size: 14px;
            border: none;
            border-radius: 2px;
            cursor: pointer;
        }
        .btwen_text_tk_cos{
            width: 606px;
            height: 60px;
            padding-left: 8px;
            padding-top: 5px;
        }
        .layui-btn{
            margin-left: 10px;
            height: 33px;
            line-height: 33px;
        }
        .kzjxx_iteam{
            height:50px;
        }
        .img_webk{
            height: 33px;
            width: 85px;
            margin-left: 10px;
            border: none;
        }
        .wjdc_list li{
            line-height: 50px;
        }
    </style>
</head>
<body>
<div class="admin-main layui-anim layui-anim-upbit" ng-app="hd" ng-controller="ctrl">
    <fieldset class="layui-elem-field layui-field-title">
        <legend>{$title}</legend>
    </fieldset>
    <div class="layui-form-item" style="margin-left: 50px">
        <label class="layui-form-label">标题</label>
        <div class="layui-input-block">
            <input type="text" id="title" name="title" {if condition="$info['id'] neq ''"}value="{$info['title']}"{/if} required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" style="width: 650px;">
        </div>
    </div>
    <div class="layui-form-item" style="margin-left: 50px">
        <label class="layui-form-label">期数</label>
        <div class="layui-input-block">
            <input type="text" id="f_title" name="f_title" {if condition="$info['id'] neq ''"}value="{$info['f_title']}"{/if} required  lay-verify="required" placeholder="请输入期数" autocomplete="off" class="layui-input" style="width: 650px;">
        </div>
    </div>
    <div class="all_660" style="margin-left: 50px">
        <input TYPE="hidden" name="id" id="tsetid" value="{$info.id}">
        <div id="content" class="yd_box" style="margin-left: 110px;margin-top: 20px;width: 700px">
            {volist name="content" id="vo" key="k"}
            <div class="movie_box" style="border: 1px solid rgb(255, 255, 255);">
                <ul class="wjdc_list">
                    <input type='hidden' class='scot' value='{$vo.score}'>
                    <li>
                        <div class="tm_btitlt">
                            <i class="nmb">{$k}</i>
                            .
                            <i class="btwenzi">{$vo.title}</i>
                            {if condition="$vo.type eq 1"}
                            <span class="tip_wz">【单选】</span>
                            {elseif condition="$vo.type eq 2"}
                            <span class="tip_wz">【多选】</span>
                            {elseif condition="$vo.type eq 3"}
                            <span class="tip_wz">【判断】</span>
                            {else/}
                            <span class="tip_wz">【问答】</span>
                            {/if}

                        </div>
                    </li>
                    {volist name="$vo.input" id="vv"}
                    <li class="input">
                        <input type="hidden" name="upload_name" value="{$vv.val}" class="upload_names">
                        <label>
                            {if condition="$vo.type eq 1"}
                            <input name="a{$k}0" type="radio" {if condition="$vv.answer eq 1"}checked="checked"{/if} value="{$vv.val}" />
                            {elseif condition="$vo.type eq 2"}
                            <input name="a{$k}0" type="checkbox" {if condition="$vv.answer eq 1"}checked="checked"{/if} value="{$vv.val}" />
                            {elseif condition="$vo.type eq 3"}
                            <input name="a{$k}0" type="radio" {if condition="$vv.answer eq 1"}checked="checked"{/if} value="{$vv.val}" />
                            {else/}
                            <input name="a{$k}0" type="radio" value="{$vv.val}">
                            {/if}
                            <span>{php}$p=strrchr($vv['val'],'.');{/php}{if condition="$p eq '.png' || $p eq '.jpg' || $p eq '.jpeg' || $p eq '.gif'"}<img src="__PUBLIC__{$vv.val}" >{else/}{$vv.val}{/if}</span>
                        </label>
                    </li>
                    {/volist}

                </ul>
                <div class="dx_box" data-t="{$vo.type-1}" style="display: none"></div>
            </div>
            {/volist}
        </div>
        <div class="but" style="padding-top: 20px">
            <label class="layui-form-label">请选择题型</label>
            <select id="addquerstions" class="addquerstions" name="type">
                <option value="-1">请选择</option>
                <option value="0">单选</option>
                <option value="1">多选</option>
                <option value="2">判断</option>
                <!--<option value="3">填空</option>-->
            </select>
            <button class="btu" id="addClick" >添加题目</button>
        </div>

        <!--选项卡区域  模板区域---------------------------------------------------------------------------------------------------------------------------------------->
        <div class="xxk_box">
            <div class="xxk_conn hide">
                <!--单选----------------------------------------------------------------------------------------------------------------------------------------->
                <div class="xxk_xzqh_box dxuan ">
                    <textarea name="subject" cols="" rows="" class="input_wenbk btwen_text btwen_text_dx" placeholder="单选题目"></textarea>
                    <div class="title_itram">
                        <div class="kzjxx_iteam">
                            <input name="answer" type="radio" value="1" class="dxk">
                            <input name="optiond" type="text" class="input_wenbk" value="" placeholder="选项">
                            <img src="" class="input_wenbk img_webk file_upload" style="display: none">
                            <button type="button" class="layui-btn layui-btn-primary file_upload"><i class="icon icon-upload3"></i>点击上传
                            </button>
                            <input type="hidden" name="upload_name" value="" class="upload_names">
                            <a href="javascript:void(0);" class="del_xm">删除</a>
                        </div>
                    </div>
                    <a href="javascript:void(0)" class="zjxx">增加选项</a>
                    <div style="margin-top: 10px">
                        <div style="float: left;width: 48%;">
                            <label>此题分数：</label>
                            <input name="score" type="number" class="input_wenbk score" value="" placeholder="分数" style="width: 50%;">
                        </div>
                    </div>
                    <div style="clear: both;"></div>
                    <!--完成编辑-->
                    <div class="bjqxwc_box">
                        <a href="javascript:void(0);" class="qxbj_but">取消编辑</a>
                        <a href="javascript:void(0);" class="swcbj_but"> 完成编辑</a>
                    </div>
                </div>
                <!--多选----------------------------------------------------------------------------------------------------------------------------------------->
                <div class="xxk_xzqh_box duoxuan hide">
                    <textarea name="subject" cols="" rows="" class="input_wenbk btwen_text btwen_text_duox" placeholder="多选题目"></textarea>
                    <div class="title_itram">
                        <div class="kzjxx_iteam">
                            <input name="answer" type="checkbox" value="1" class="dxk">
                            <input name="optiond" type="text" class="input_wenbk" value="" placeholder="选项">
                            <img src="" class="input_wenbk img_webk file_upload" style="display: none">
                            <button type="button" class="layui-btn layui-btn-primary file_upload"><i class="icon icon-upload3"></i>点击上传
                            </button>
                            <input type="hidden" name="upload_name" value="1" class="upload_names">
                            <a href="javascript:void(0);" class="del_xm">删除</a>
                        </div>
                    </div>
                    <a href="javascript:void(0)" class="zjxx">增加选项</a>
                    <div style="margin-top: 10px">
                        <div style="float: left;width: 48%;">
                            <label>此题分数：</label>
                            <input name="score" type="number" class="input_wenbk score" value="" placeholder="分数" style="width: 50%;">
                        </div>
                    </div>
                    <div style="clear: both;"></div>
                    <!--完成编辑-->
                    <div class="bjqxwc_box">
                        <a href="javascript:void(0);" class="qxbj_but">取消编辑</a>
                        <a href="javascript:void(0);" class="swcbj_but"> 完成编辑</a>
                    </div>
                </div>
                <!--判断----------------------------------------------------------------------------------------------------------------------------------------->
                <div class="xxk_xzqh_box dxuan ">
                    <textarea name="subject" cols="" rows="" class="input_wenbk btwen_text btwen_text_dx" placeholder="判断题目"></textarea>
                    <div class="title_itram">
                        <div class="kzjxx_iteam">
                            <input name="answer" type="radio" value="1" class="dxk">
                            <input name="optiond" type="text" class="input_wenbk" value="" placeholder="选项">
                            <img src="" class="input_wenbk img_webk file_upload" style="display: none">
                            <button type="button" class="layui-btn layui-btn-primary file_upload"><i class="icon icon-upload3"></i>点击上传
                            </button>
                            <input type="hidden" name="upload_name" value="" class="upload_names">
                            <a href="javascript:void(0);" class="del_xm">删除</a>
                        </div>
                    </div>
                    <a href="javascript:void(0)" class="zjxx">增加选项</a>
                    <div style="margin-top: 10px">
                        <div style="float: left;width: 48%;">
                            <label>此题分数：</label>
                            <input name="score" type="number" class="input_wenbk score" value="" placeholder="分数" style="width: 50%;">
                        </div>
                    </div>
                    <div style="clear: both;"></div>
                    <!--完成编辑-->
                    <div class="bjqxwc_box">
                        <a href="javascript:void(0);" class="qxbj_but">取消编辑</a>
                        <a href="javascript:void(0);" class="swcbj_but"> 完成编辑</a>
                    </div>
                </div>
                <!-- 填空----------------------------------------------------------------------------------------------------------------------------------------->
                <div class="xxk_xzqh_box tktm hide">
                    <textarea name="subject" cols="" rows="" class="input_wenbk btwen_text btwen_text_tk" placeholder="答题区"></textarea>
                    <div>
                        <div style="margin-top: 10px">
                            <label>此题分数：</label>
                            <input name="score" type="number" class="input_wenbk score" value="" placeholder="分数" style="width: 20%;">
                        </div>
                    </div>
                    <!--完成编辑-->
                    <div class="bjqxwc_box">
                        <a href="javascript:void(0);" class="qxbj_but">取消编辑</a>
                        <a href="javascript:void(0);" class="swcbj_but"> 完成编辑</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="clear: both;margin-top: 100px;"></div>

    <div class="layui-input-block" style="margin-left: 160px;margin-top: 20px">
        <button class="btu" onclick="smit()">提交</button>
        <a href="{:url('index')}" class="layui-btn layui-btn-primary">{:lang('back')}</a>
    </div>
    <form action="" enctype="multipart/form-data" style="display: none">
        <input type="file" name="file"  id="img_upload" >
    </form>
</div>
</body>
</html>
<div id="pop" class="hide" style="display: none">
    <img src=""/>
</div>
<script type="text/javascript">
    $('img').bind('click',function(){
        var src=$(this).attr('src');
        $('#pop').find('img').attr('src',src);
        layer.open({
            type: 1,
            title: false,
            closeBtn: 0,
            area: '600px',
            skin: 'layui-layer-nobg', //没有背景色
            shadeClose: true,
            content: $('#pop')
        });
    })
</script>
<script type="text/javascript" src="__STATIC__/plugins/layui/layui.js"></script>
<script type="text/javascript" src="__STATIC__/common/js/common.js"></script>
<script type="text/javascript">
    $('body').on('click','.file_upload',function(){
        $('#img_upload').trigger('click');
        $_this=$(this);
        layui.use([ 'layer','upload'], function () {
            var upload = layui.upload,$ = layui.jquery;
            upload.render({
                elem: '#img_upload'
                ,url: '{:url("UpFiles/upload")}'
                ,accept: 'images' //普通文件
                ,exts: 'jpg|png|gif' //只允许上传压缩文件
                ,done: function(res){
                    if(res.code==1){
                        $_this.hide();
                        $_this.siblings(".img_webk").show();
                        $_this.siblings(".img_webk").attr('src',"__PUBLIC__"+res.url);
                        $_this.siblings(".upload_names").attr('value',res.url);
                    }else{
                        layer.msg(res.msg,{icon: 2, time: 1000});
                    }
                }
            });
        });

    });

    function smit(){
        layui.use('layer', function(){
            var layer = layui.layer;
            layer.load(1);
        });
        var titles = $('#title').val();
        var f_title = $('#f_title').val();
        var id = $('#tsetid').val();
        var content = getTest();
        console.log(content);
        $.ajax({
            url:"{:url('edit')}",
            type:'post',
            data:{"title":titles,"content":content,"id":id,"f_title":f_title},
            success:function(res){
                layer.closeAll();
                if (res.code > 0) {
                    layer.msg(res.msg, {time: 1800, icon: 1}, function () {
                        location.href = res.url;
                    });
                } else {
                    layer.msg(res.msg, {time: 1800, icon: 2});
                }
            }
        });
    }
</script>
